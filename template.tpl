___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "PropellerAds S2S Conversion Tracker",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAIAAABt+uBvAAAAAXNSR0IArs4c6QAADTpJREFUeNrtmod3E1cWxvOHbGwL23KTZXVZtizZlgzBEAyETSAJsPRAAAMxEAhgQk9YWoAlSyD0DqGT0EwLC6G3DSQQerApptnUhfX+Rm8zGSzBQrwHS5x3zjs6o5n3Zu775rvffe/eee3Kr3Vke0Z7LUzsCNsmAZIASYAkQBKgMG4SIAmQBEgCJAEK4yYBkgBJgCRAEqAwbhIgCZAESAIkAQrjJgGSAEmAagegyxf51fEb1LSXXqqtWqsunVNa2QXlL7/ir3q1lgEqPV+n9ELtwCSeWF6mu3c7+v7t6BtXYkDnxhUdx5y5flknrHo5Lvbfh1299ES7VqqruB5zuxzLVIxeKoNA59ih+L9NMk0YZ965LfHOjZg9/0iYOME8eaL50F49GJW9HAYpb+ay7sAefbdu6V27pnfv7iwsVFrRR86Rw60bv0vm7YGXipHmQKceBJ3UBU9Y/KoH2kvBw7GKd7Ph22Sb3ZeYnDd1iqnq0etzZhkNRr/J4luxLIWXB8EZ8sxHh7b2hQG6dTVm+5ZEV0YuDYMwIjXNb0j1m62+jMzc4cOsACQkAJtowvsucaBBTZzhV2UcTZwXJ2l0oHFQDe7g4YpV12K2bEry52Vjw6yvjVUPoxYvSM3y5OTkZq9dlVJRDkDBY7WQPdXaFwbo5tWY77clYkqmOxcezZ1lnP5VGtxu3tzt8eZY7b7ZM4wYBEzwvPI6B4r3oQW4oZhMeSmXou/dir57K5qJqVbS6HnnZvT1Mh1OQQdatQ4M5z7cWTucKXFQsjEJOJzpuTOnp1U9fH3h/FTAwqQ1AYAYGHKsaDwxpLU88Y8DZLH58PCqx69D73/didq/W18/3wut2rbNQBGOHNDPm5O6dLHh7KnYFcsMX4w3nzgWx+Mh4Mkf4xbMTZ30hRlfYFZgIazhvS1fapgz03h4v542ZbJp0kRzyQY6xGCoypTTP8Uump86aYIyfNvmpBuXmSe8/h8AEc5CjuXOWMvj5gdZy/kaMQj/GjPacvNKzLlTsRfPxHK7Tp1cjvTcgsZZHC+cl2o0+XN92d27OUHNbPEx1QcV0WtWJjdq5LE7FLHAN91ZOR/3dVw4XQeYzp6Mzcvz0rNVq4y69bz6xDzeAZMcN9aMtAmabNmY1LRplt2pDDcGhg8bakMpbl+L2bwhNEC4GAO5Q8ixZRd0cBZ00kw+rbVbNyUxivnWiEG8YeSQGz2ojD51IpbHc/d333VzBgnAPro5nLk8OD/fu293AoHG5/c6AbHAg6h375bOBCxW3+BiG8QGoIYNPTm5OQzs1NE1coS1SdMsdIR7bliXjFP883D8m28q4DZo6Bk2xNalSzpXMQMfh8Kb1ocGaPWKlHuMPRR67LSpaf++HwWjtdbSZ9f2RGb6xwHy+bPTM3J79HB+s8Qwf44R3enY0eXNZrYKrR7/9kiM6F3kOLhXj33lZTGfjbTaHD7s4GViNAzv19eR7sIy7+H98XgBljmcvh6F6Tgdqxi8gM6cGTjA/vheFMwXw4kSuPb9iijYxyRbtcyEyCWbQgO0ankKEBD+Q45t2TKTd7NowRPWHj8Sd/FMzUQaU2jc1GTxAwrexAHwE/IhApPHxVwB+2A+nsWEeV6HDi6sbNcu49olHXBg2bdrkjGL+yxbbEChGjTwWG2+oUNscBCf4gyd8WXQ5xjGAVajgqwlCw3cH2r0+9gOv/LzPed/qbOtJDE7CKAsNGhlCjGh64ehx6Kbv56ts3SRgWPVWp5Fq5FIw0Mmhk990MnVvr3rwy6uAZ/YeTZyIIIRWsgj4RQQCK5ix/vvZxLmPurl5PEsu9GFbSVJkNHuyJ0904hy5QOQ3Vc80A4jxI4BNgFZ69aZvNJ2bTMy3byZnFSjHxFBwng39IfLJ47G79iamJ0TBJBH0SAk/C+tQ4+FvwQN/IADYS2dS/8vYZ67jxtjqbwRDRfAhfOVN2Low19CpgrQd2uTUVAG0oCSUZ07uyAUug5N1q9L5r3RE83iJAABx5BPbQAEoAHSKQzq0N7F8C5dlCDQpEkWaM6Ynob0gAW+zC8P3boZFwsNEC+MAOIMNZZjUFiy8HdrNfsBWg0BGmtBO8UajEvqQquyGkCBKMsvYoyLweoDe/UP70Tfr4hGqp2uXCbGzoCBaBA62qfIAe6P7kYd2qev94aXuNO/n+PhnShWoYBFgNu1I6Gq6k9ICcHhh50JvAAiEd7xNA16dC9q+FDkL8RYJcJUIAjVAGJGNQCIzQ52Y8qEcRbcW6w71YW5AAhGuD05eCIcEQBhyo4tiYIvSOOM6cYRw6wiGiL23BbxgkF0wNBBA+0If5s2GfyF/EyS+ezZmYA/8rdBAy+hABYUFTkIyZ+PsqLoABRyJY0GAQEvIORY4gYRkNfpzhLW1hgg5olwQPU4fd1RI6yCQVpC8pf3yQo7xaDsP7BPrPTFNoUtEkqBoiel5KWk+nmroHDiaJwACAZhaKMCD3qfkJiHTECZIYNtrJLEOmj18hQIiBsmG/K4AxsdXhVkISwwN6t2LzbTyAbIZFb2YlAMvQs5dsG8VLiJ3z1pbQ3SHUjp8aPxUyabx46xbFrP7rS6x4pUA+yFXyyXWaSKhINoTJKXScAeXGwfNtSKCqA118uUqMGCk6UKEwAR1mkoUXGxDSKoMYU7M9UfD8dP/dJEHzpM/TLt2MF4TordPCv78WMtgd087sNTFAMI2wLfkGOxh6tB1tYs3cFmit0KCsLd1V1StT5qOobJa7ejwkmhGL+QmZkwebFLUgBqpEQxpOphZRQ3p+Gt1fZi3PDuzWhxlfswH06KNyesuqnJB9HEhJ89NtjamibM0B2RuwtKj3EclNBT+yi/XPp9y65mIQRA7ELwqU+LbawhGat20Dyl2nB+nzujGHpsyM61l5NWLdDqugoQGsGac9AAu9gHaVIzIYc/53yePTYSkvbCVl7p+rXJbKZ370wAr8AcwiJFX/sAqS6AKrGoQxFU0QkTRMKCQfz+Jg38lQyK5CYBkgBFBEDPHXefrGec41cd+OoCFISO9sxTwxzLX9bKRDo1zL2yAInpiSWiqM1qKo5PXSixqyTHsnwp6cdXmkFMTN18sh1t38FFFn17SaJYQKu80JZhQYSkInuR+IS6nT9wiZoMTXTTEPAVAkjMjdwQSTKT2V88yKZm82jVdIfzAETSljxU7yKnutRWS7il1cuwkQwQcxD02bqJFJqSqSJJBjtOHo8rL61GBx0FT9I9bLXLztdp0dzNbrZXL6foJnbt5KREsZQMgTo2ggFSy/NoLSlXW6BWRTIQapD6JL/BJVWeoJgodZKBO340DrqRgQQgwSAQ2bsr4etpaXzIMe2rtO+3Jj759UQkA8QMz5yMbdYsiwlTI+zZw5lm8hd2TxcZGSE65NI4D3BcIlX41ltZBY09pKh79XRyle9MSB6Sn6RKQYaQNAA0JMnJJVXXIxUgOILjEIyonWW6c0ikk4oll5hX17v/Bz1eI6pmkyeagA8fbNsmY9RIpdBKQpYh1IIYvr0kib8Ucwb0t6/8JqVvHwfJtoSkvFkzjHcCNIxIBqnKSt4PrQWUZn92A8e+3fpAgcxH2pTJiwxWixZu0uz88tEBGT8ypKQcqf8VFqaTh58xLY2r+CYJUwoVEAcm9untIAMfqMRFJkBCnsl1Hj0YT3oMxaUoTJUGlcWblDpyq0w8CxIBxxv1vSBI0YLMrAhS772XCU3oCb9YFmRCqAwQzESk1q1OJsyRq1VzrJHnYqo8M2G+GkBcUBCiO/41d7axsLsTd6NYzLdi8AVeUHWgsMHHR0Qo0LlwOpYoBkCINMVr1IrSRf18D2fQINhE1YiPZgIiHZkapFmeKEV3aljIKsUpCsE05kkZi4ISkEGoI/v1MAhOQTEAhVaXzsEgtyheo/EwBb7wRQ9ln+FDbVRN0SMYh4tVXI9UDdKJyhp1dG9ONur7zjvunj2dyreOtEJn48bKJKmL/fJTHMX7t992w7L27VwMpNB65udYUECniGKEc0qPKA6BjMpf1YMoSuwFBcpVUtq3yyNTg1T/GjvaAn3wL5LQVJlZ7NDwI2pVoqC+eIGBb1Yoe8IIvtkoKnISmyAdl2hoEBSDWRQv8UqCHXFw7uxUGJdm9vO3MkKjmKipnToeV6+eF9XgWzRkFclQ18QU+YjcLHlat1a+4zv9cyx1VzBi2mCBJDGEvRiflIiSFp+UID24J5VY1kF4X5fO6RANB4xUDWLafExFDZMS6KrlBjETTdMh2BPGW/4+xYS4sBSgHk0tlA+o/vq5BVXi44LRn1lZQDF5dJrhfLxBmPukv33EcCuf+UCc8rIIXknrBEYEKSWtU65N6wiklLo+V/EgteKKS7KuwROhmPgYAw1WMeWYS0AZOIjhPhG8F9OUQKsnBoNzhtozmoqouBr8abU4eHV28y8CaOh8IwdP6xD5+aBIbxIgCZAESAIkAQrjJgGSAEmAJEASoDBuEiAJkARIAiQBCuMmAZIASYAkQBKgMG4SIAmQBEgCVJvtP54xz+qPR00bAAAAAElFTkSuQmCC"
  },
  "description": "Tag that allows you to integrate PropellerAds S2S conversion tracking. More info at https://help.propellerads.com/en/articles/1954809-how-to-integrate-propellerads-s2s-conversion-tracking.",
  "containerContexts": [
    "WEB"
  ],
  "categories": ["ADVERTISING", "ANALYTICS", "CONVERSIONS", "MARKETING", "REMARKETING"]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "advertiserId",
    "displayName": "Advertiser ID",
    "simpleValueType": true,
    "help": "Advertiser ID is the \u003cb\u003eaid\u003c/b\u003e query parameter value of your S2S Postback URL, which you can find at \u003ca href\u003d\"https://partners.propellerads.com/#/tracking\" target\u003d\"_blank\"\u003ehttps://partners.propellerads.com/#/tracking\u003c/a\u003e.",
    "lineCount": 1,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      },
      {
        "type": "POSITIVE_NUMBER",
        "errorMessage": "The value must be your Advertiser ID, which is a numeric value."
      }
    ],
    "valueHint": "1234567",
    "alwaysInSummary": true
  },
  {
    "type": "TEXT",
    "name": "trackerId",
    "displayName": "Tracker ID",
    "simpleValueType": true,
    "help": "Tracker ID is the \u003cb\u003etid\u003c/b\u003e query parameter value of your S2S Postback URL, which you can find at \u003ca href\u003d\"https://partners.propellerads.com/#/tracking\" target\u003d\"_blank\"\u003ehttps://partners.propellerads.com/#/tracking\u003c/a\u003e.",
    "lineCount": 1,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      },
      {
        "type": "POSITIVE_NUMBER",
        "errorMessage": "The value must be your Tracker ID, which is a numeric value."
      }
    ],
    "valueHint": "12345",
    "alwaysInSummary": true
  },
  {
    "type": "TEXT",
    "name": "visitorId",
    "displayName": "Visitor ID",
    "simpleValueType": true,
    "help": "Visitor ID is a value of a query parameter containing a value of the \u003cb\u003e${SUBID}\u003c/b\u003e macro of your campaign\u0027s URL. This is usually the \u003cb\u003eclickid\u003c/b\u003e query parameter value of your campaign\u0027s URL, but the query parameter can be any name, the main thing is that it must contain a value of the \u003cb\u003e${SUBID}\u003c/b\u003e macro.\u003c/br\u003e\u003c/br\u003e\n\nSince this value will be different for every visitor every time, you need to get this value from the URL where the visitor came to your site, save it to a \u003ci\u003evariable\u003c/i\u003e and use this variable here, or use a ready-made variable (if exist) that you can find at \u003ca href\u003d\"https://tagmanager.google.com/gallery/#/variables?filter\u003dpropeller\" target\u003d\"_blank\"\u003ehttps://tagmanager.google.com/gallery\u003c/a\u003e.\u003cbr\u003e\u003cbr\u003e\n\n\u003ci\u003eIf an incorrect value is specified, the hit will not be sent!\u003c/i\u003e",
    "lineCount": 1,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "valueHint": "{{PropellerAds Visitor ID}}"
  },
  {
    "type": "TEXT",
    "name": "payout",
    "displayName": "Conversion value (optional)",
    "simpleValueType": true,
    "lineCount": 1,
    "help": "Conversion value is the monetary value of the conversion.\u003cbr\u003e\u003cbr\u003e\n\n\u003ci\u003eIf no value is specified or an incorrect value is specified, the conversion value will be equal to zero.\u003c/i\u003e",
    "valueHint": "5"
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const queryPermission = require('queryPermission');
const sendPixel = require('sendPixel');
const encodeUriComponent = require('encodeUriComponent');
const logToConsole = require('logToConsole');

const advertiserId = data.advertiserId;
const trackerId = data.trackerId;
const visitorId = data.visitorId;
if (data.payout > 0) {
  var payout = data.payout;
} else {
  var payout = 0;
}

if (visitorId > 0) {
  const url = 'https://ad.propellerads.com/conversion.php?aid=' + encodeUriComponent(advertiserId) + '&tid=' + encodeUriComponent(trackerId) + '&visitor_id=' + encodeUriComponent(visitorId) + '&payout=' + encodeUriComponent(payout);

  if (queryPermission('send_pixel', url)) {
    sendPixel(url, data.gtmOnSuccess, data.gtmOnFailure);
  }
  logToConsole(url);
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "send_pixel",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://ad.propellerads.com/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 17.11.2021, 09:30:15
